<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>English Learning Game - Complete the Sentences</title>
<style>
  :root{ --accent:#4aa4ff; --success:#2ecc71; --danger:#d62828; --bg1:#87cefa; --bg2:#e0f7ff }
  body { font-family: Inter, Arial, sans-serif; background: linear-gradient(var(--bg1), var(--bg2)); padding: 18px; margin:0 }
  .container { max-width: 980px; margin: auto; background: white; padding: 18px; border-radius: 12px; box-shadow: 0 8px 30px rgba(2,8,23,0.08);} 
  h2 { margin-top:0 }
  .topbar{display:flex; justify-content:space-between; align-items:center; gap:12px}
  .controls { display:flex; gap:8px; align-items:center; margin-bottom:12px }
  .btn { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700 }
  .btn.play { background:var(--accent); color:#fff }
  .btn.translate { background:#00b050; color:#fff }
  .btn.secondary { background:#fff; border:1px solid #ddd }
  .scorebox { background:linear-gradient(90deg,#fff,#f3fbff); padding:8px 12px; border-radius:10px; border:1px solid #e6f0ff; font-weight:800 }

  .question { margin-bottom: 14px; padding: 12px; background: #f3fbff; border-left: 6px solid var(--accent); border-radius: 8px; }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  input[type='text'] { padding: 8px; width: 200px; border-radius: 8px; border: 1px solid #ccc; font-size: 15px }
  .feedback { margin-left: 8px; font-weight:700 }

  #textSection { margin-top: 18px; padding: 14px; background: #fffbe8; border-left: 6px solid #ffcc00; border-radius:8px }
  #translatedText { display:none; color:#333; margin-top:10px }

  /* small characters */
  .characters{position:relative; height:60px; margin-bottom:10px}
  .char{position:absolute; bottom:0; width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px; box-shadow:0 6px 18px rgba(0,0,0,0.12)}
  .char.one{left:10px; background:linear-gradient(135deg,#ffd166,#06d6a0); animation: bob 4s ease-in-out infinite}
  .char.two{right:10px; background:linear-gradient(135deg,#4cc9f0,#8ec5ff); animation: bob 3.6s ease-in-out infinite}
  @keyframes bob{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}

  /* option box */
  .options { margin-top:12px; display:flex; gap:8px; flex-wrap:wrap }
  .choice{ padding:8px 12px; background:#fff; border-radius:8px; border:1px solid #d7eafc; cursor:pointer }

  /* confetti canvas */
  #confettiCanvas{ position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none }

  @media (max-width:720px){ input[type='text']{ width:130px } .container{padding:12px} }
</style>
</head>
<body>
<canvas id="confettiCanvas"></canvas>
<div class="container">
  <div class="topbar">
    <h2>Complete the Sentences</h2>
    <div style="display:flex; gap:12px; align-items:center">
      <div class="scorebox">Score: <span id="score">0</span></div>
      <label><input type="checkbox" id="globalTranslate"> Mostrar em Portugu√™s</label>
    </div>
  </div>

  <div class="characters">
    <div class="char one">ü§ñ</div>
    <div class="char two">üêµ</div>
  </div>

  <!-- Questions -->
  <div id="questions">
    <div class="question" data-en="I love swimming in the ________" data-pt="Eu amo nadar no ________">
      <div class="row">
        <div style="flex:1">1. <span class="sentence">I love swimming in the ________</span></div>
        <input type="text" id="q1" placeholder="type answer" />
        <button class="btn play" data-word="river" data-q="1">Play Word</button>
        <button class="btn translate" data-target="q1_text">Translate</button>
        <span class="feedback" id="fb1"></span>
      </div>
      <div id="q1_text" style="display:none; margin-top:8px; color:#333">Eu amo nadar no rio.</div>
    </div>

    <div class="question" data-en="I went hiking the other day and we found a beautiful _______ full of water falling." data-pt="Fui fazer trilha e encontramos uma linda _______ cheia de √°gua caindo.">
      <div class="row">
        <div style="flex:1">2. <span class="sentence">I went hiking the other day and we found a beautiful _______ full of water falling.</span></div>
        <input type="text" id="q2" placeholder="type answer" />
        <button class="btn play" data-word="waterfall" data-q="2">Play Word</button>
        <button class="btn translate" data-target="q2_text">Translate</button>
        <span class="feedback" id="fb2"></span>
      </div>
      <div id="q2_text" style="display:none; margin-top:8px; color:#333">Eu fui fazer trilha e encontramos uma linda cachoeira cheia de √°gua caindo.</div>
    </div>

    <div class="question" data-en="Janet was telling me she went to Thailand and visited some small _______" data-pt="Janet me disse que foi √† Tail√¢ndia e visitou algumas pequenas _______">
      <div class="row">
        <div style="flex:1">3. <span class="sentence">Janet was telling me she went to Thailand and visited some small _______</span></div>
        <input type="text" id="q3" placeholder="type answer" />
        <button class="btn play" data-word="islands" data-q="3">Play Word</button>
        <button class="btn translate" data-target="q3_text">Translate</button>
        <span class="feedback" id="fb3"></span>
      </div>
      <div id="q3_text" style="display:none; margin-top:8px; color:#333">Janet me disse que foi √† Tail√¢ndia e visitou algumas pequenas ilhas.</div>
    </div>

    <div class="question" data-en="The other night, we sat on the grass to see the sky. We saw many ______" data-pt="Na outra noite, sentamos na grama para ver o c√©u. Vimos muitas ______">
      <div class="row">
        <div style="flex:1">4. <span class="sentence">The other night, we sat on the grass to see the sky. We saw many ______</span></div>
        <input type="text" id="q4" placeholder="type answer" />
        <button class="btn play" data-word="stars" data-q="4">Play Word</button>
        <button class="btn translate" data-target="q4_text">Translate</button>
        <span class="feedback" id="fb4"></span>
      </div>
      <div id="q4_text" style="display:none; margin-top:8px; color:#333">Na outra noite, sentamos na grama para ver o c√©u. Vimos muitas estrelas.</div>
    </div>

    <div class="question" data-en="To get to the countryside, we have to drive through a long ______" data-pt="Para chegar ao interior, precisamos dirigir por uma longa ______">
      <div class="row">
        <div style="flex:1">5. <span class="sentence">To get to the countryside, we have to drive through a long ______</span></div>
        <input type="text" id="q5" placeholder="type answer" />
        <button class="btn play" data-word="road" data-q="5">Play Word</button>
        <button class="btn translate" data-target="q5_text">Translate</button>
        <span class="feedback" id="fb5"></span>
      </div>
      <div id="q5_text" style="display:none; margin-top:8px; color:#333">Para chegar ao interior, precisamos dirigir por uma longa estrada.</div>
    </div>
  </div>

  <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
    <button class="btn secondary" id="checkAll">Check Answers</button>
    <button class="btn secondary" id="clearAll">Clear</button>
    <div style="margin-left:auto">Quick options:</div>
  </div>

  <div class="options" id="quickOptions">
    <div class="choice">road</div>
    <div class="choice">stars</div>
    <div class="choice">islands</div>
    <div class="choice">waterfall</div>
    <div class="choice">River</div>
  </div>

  <h2 style="margin-top:18px">Reading Section</h2>
  <div id="textSection">
    <p id="mainText">
      Living in the city has some problems, like traffic and noise, but it also has advantages, like being close to important places. We can live in the countryside too, but it is far from many places and the roads are not always good. Still, like the city, it has advantages too, such as less pollution. Speaking about pollution, we can reduce it by doing many things, like recycling, planting things, walking, or cycling.
    </p>
    <p id="translatedText">Viver na cidade tem alguns problemas, como tr√¢nsito e barulho, mas tamb√©m tem vantagens, como estar perto de lugares importantes. Podemos viver no interior tamb√©m, mas √© longe de muitos lugares e as estradas nem sempre s√£o boas. Ainda assim, assim como a cidade, tamb√©m tem vantagens, como menos polui√ß√£o. Falando em polui√ß√£o, podemos reduzi-la fazendo muitas coisas, como reciclar, plantar coisas, caminhar ou andar de bicicleta.</p>
  </div>

</div>

<script>
// answers and tolerant matching (accept small variants)
const answers = { q1: ['river'], q2: ['waterfall'], q3: ['islands','island'], q4: ['stars','star'], q5: ['road','roads'] };

// UI refs
const scoreEl = document.getElementById('score');
let score = 0;

// live validation on input
for(let i=1;i<=5;i++){
  const input = document.getElementById('q'+i);
  input.addEventListener('input', ()=> validateSingle(i));
}

function normalize(s){ return s.trim().toLowerCase().replace(/[^a-z]/g,''); }

function validateSingle(i){
  const id = 'q'+i; const val = normalize(document.getElementById(id).value);
  const fb = document.getElementById('fb'+i);
  const possible = answers[id];
  const wasCorrect = fb.dataset.correct === 'true';
  const ok = possible.some(p => normalize(p) === val);
  if(ok && !wasCorrect){
    fb.innerText = document.getElementById('globalTranslate').checked ? 'Correto' : 'Correct';
    fb.style.color = 'green';
    fb.dataset.correct = 'true';
    score += 10; updateScore(); celebrateSmall(id);
  } else if(!ok && wasCorrect){
    fb.innerText=''; fb.dataset.correct='false'; score = Math.max(0, score-10); updateScore();
  } else if(!ok){
    fb.innerText=''; fb.dataset.correct='false';
  }
}

function updateScore(){ scoreEl.innerText = score; }

// small celebration effect for single correct (sparkle)
function celebrateSmall(id){
  const el = document.getElementById('q'+id);
  el.animate([{transform:'scale(1)'},{transform:'scale(1.04)'},{transform:'scale(1)'}], {duration:400});
}

// Play word buttons
document.querySelectorAll('.btn.play').forEach(btn => {
  btn.addEventListener('click', ()=> speak(btn.dataset.word));
});
function speak(text){ if(!window.speechSynthesis) return; const u = new SpeechSynthesisUtterance(text); u.lang = 'en-US'; speechSynthesis.cancel(); speechSynthesis.speak(u); }

// per-question translate toggles
document.querySelectorAll('.btn.translate').forEach(btn => {
  btn.addEventListener('click', ()=>{
    const target = document.getElementById(btn.dataset.target); if(!target) return; target.style.display = target.style.display === 'none' ? 'block' : 'none';
  });
});

// global translate
const globalToggle = document.getElementById('globalTranslate');
const questionNodes = document.querySelectorAll('.question');
const mainText = document.getElementById('mainText');
const translatedText = document.getElementById('translatedText');

globalToggle.addEventListener('change', ()=>{
  const on = globalToggle.checked;
  questionNodes.forEach(q => {
    const sentenceSpan = q.querySelector('.sentence');
    sentenceSpan.innerText = on ? q.dataset.pt : q.dataset.en;
    const tid = q.querySelector('.btn.translate').dataset.target; const tEl = document.getElementById(tid);
    tEl.style.display = on ? 'block' : 'none';
  });
  mainText.style.display = on ? 'none' : 'block';
  translatedText.style.display = on ? 'block' : 'none';
  document.querySelectorAll('.btn.play').forEach(b=> b.innerText = on ? 'Ouvir' : 'Play Word');
  document.querySelectorAll('.btn.translate').forEach(b=> b.innerText = on ? 'Traduzir' : 'Translate');
});

// check all
document.getElementById('checkAll').addEventListener('click', ()=>{
  for(let i=1;i<=5;i++){ validateSingle(i); }
  // full success?
  const allCorrect = Array.from({length:5}, (_,i)=> document.getElementById('fb'+(i+1)).dataset.correct==='true').every(x=>x);
  if(allCorrect){ bigCelebrate(); }
});

// clear
document.getElementById('clearAll').addEventListener('click', ()=>{
  for(let i=1;i<=5;i++){ document.getElementById('q'+i).value=''; document.getElementById('fb'+i).innerText=''; document.getElementById('fb'+i).dataset.correct='false'; }
  score = 0; updateScore();
});

// quick options (fill input when clicked)
document.querySelectorAll('.choice').forEach(ch => {
  ch.addEventListener('click', ()=>{
    // find focused input or first empty
    const active = document.activeElement && document.activeElement.tagName === 'INPUT' ? document.activeElement : null;
    if(active && active.id.startsWith('q')){ active.value = ch.innerText; validateSingle(active.id.replace('q','')); }
    else { // put into first empty
      for(let i=1;i<=5;i++){ const el = document.getElementById('q'+i); if(el.value.trim()===''){ el.value = ch.innerText; validateSingle(i); break; } }
    }
  });
});

// animated characters small movement already via CSS

// CONFETTI implementation (canvas)
const confettiCanvas = document.getElementById('confettiCanvas');
const ctx = confettiCanvas.getContext('2d');
let W = confettiCanvas.width = window.innerWidth; let H = confettiCanvas.height = window.innerHeight; window.addEventListener('resize', ()=>{ W = confettiCanvas.width = window.innerWidth; H = confettiCanvas.height = window.innerHeight; });

function bigCelebrate(){
  // simple confetti burst
  const pieces = [];
  for(let i=0;i<120;i++){ pieces.push({ x: W/2, y: H/3, vx:(Math.random()-0.5)*8, vy:(Math.random()-1.5)*8, r: Math.random()*6+2, c: ['#ff595e','#ffca3a','#8ac926','#1982c4','#6a4c93'][Math.floor(Math.random()*5)] }); }
  let t=0;
  function run(){ ctx.clearRect(0,0,W,H); t+=1; pieces.forEach(p=>{ p.x += p.vx; p.y += p.vy; p.vy += 0.25; p.vx *= 0.99; ctx.fillStyle=p.c; ctx.beginPath(); ctx.ellipse(p.x,p.y,p.r, p.r*0.6, 0,0,Math.PI*2); ctx.fill(); }); if(t<180) requestAnimationFrame(run); else ctx.clearRect(0,0,W,H);
  }
  run();
}

// small celebrate per question (sparkles)
function celebrateSmall(id){ const el = document.getElementById('q'+id); const orig = el.style.boxShadow; el.style.boxShadow = '0 6px 18px rgba(40,200,120,0.25)'; setTimeout(()=> el.style.boxShadow = orig, 600); }

</script>
</body>
</html>
